This is an adaptation of quantcup winning implementation to L2 updates
